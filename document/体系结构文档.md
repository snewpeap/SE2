# 影院管理系统软件体系结构文档

## 文档修改历史

|修改人员| 日期| 修改原因| 版本号 |
| :--------------------------: | ---------- | ---------------------------------------------- | ------ |
| 赖宝光、杨日东、魏进、徐凌云 | 2019-04-13 | 创建文档并完成引言部分及组合视图中开发包图部分 | v1|
|赖宝光| 2019-04-15 | 给文档各标题加上编号| v1.1   |
| 赖宝光，徐凌云，魏进，杨日东 | 2019-04-19 | 完善用户界面层，业务逻辑层，数据层的分解| v1.2   |
| 赖宝光，徐凌云，魏进，杨日东 | 2019-04-20 | 完成信息视角，加上各类图，将文档填写完整| v2|
|赖宝光，杨日东，魏进，徐凌云|2019-6-19|完成第三阶段文档部份|v3|

## 目录

- [影院管理系统软件体系结构文档](#影院管理系统软件体系结构文档)
    - [文档修改历史](#文档修改历史)
    - [目录](#目录)
    - [1. 引言](#1-引言)
        - [1.1 编制目的](#11-编制目的)
        - [1.2 词汇表](#12-词汇表)
        - [1.3 参考资料](#13-参考资料)
    - [2. 产品概述](#2-产品概述)
    - [3. 逻辑视图](#3-逻辑视图)
    - [4. 组合视图](#4-组合视图)
        - [4.1 开发包图](#41-开发包图)
        - [4.2 运行时进程](#42-运行时进程)
        - [4.3 物理部署](#43-物理部署)
    - [5. 架构设计](#5-架构设计)
        - [5.1 模块职责](#51-模块职责)
            - [5.1.1 各层职责](#511-各层职责)
                - [客户端](#客户端)
                - [服务端](#服务端)
                - [层之间调用接口](#层之间调用接口)
        - [5.2 用户界面层分解](#52-用户界面层分解)
            - [5.2.1 职责](#521-职责)
            - [5.2.2 接口规范](#522-接口规范)
        - [5.3 业务逻辑层分解](#53-业务逻辑层分解)
            - [5.3.1 职责](#531-职责)
            - [5.3.2 接口规范](#532-接口规范)
                - [表 userbl模块的接口规范](#表-userbl模块的接口规范)
                - [表 salebl模块的接口规范](#表-salebl模块的接口规范)
                - [表 moviebl模块的接口规范](#表-moviebl模块的接口规范)
                - [表 Cinemabl模块的接口规范](#表-cinemabl模块的接口规范)
                - [表 VIPCardbl模块的接口规范](#表-vipcardbl模块的接口规范)
                - [表 Statisticsbl模块的接口规范](#表-statisticsbl模块的接口规范)
        - [5.4 数据层分解](#54-数据层分解)
            - [5.4.1 职责](#541-职责)
            - [5.4.2 接口规范](#542-接口规范)
                - [表 UserDataService接口规范](#表-userdataservice接口规范)
                - [表 MovieDataService的接口规范](#表-moviedataservice的接口规范)
                - [表 VipcardDataService接口规范](#表-vipcarddataservice接口规范)
                - [表 SaleDataService接口规范](#表-saledataservice接口规范)
                - [表 CinemaDataService接口规范](#表-cinemadataservice接口规范)
    - [6. 信息视角](#6-信息视角)
        - [6.1 数据持久化对象](#61-数据持久化对象)
        - [6.2 数据库表](#62-数据库表)

## 1. 引言

### 1.1 编制目的

本报告详细完成了对影院管理系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。
本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注 |
| :-: | - | - |
|bl|业务逻辑(Business logic) ||
|vo|值对象(Value object)||
|po|持久对象(Persistence object)||

### 1.3 参考资料

1. 影院管理系统用例文档
2. 影院管理系统软件需求规格说明文档

## 2. 产品概述

参考影院管理系统用例文档和影院管理系统软件需求规格说明中对产品的概括描述。

## 3. 逻辑视图

影院管理系统中，选择了分层体系结构风格，将系统分为3层（展示层，业务逻辑层，数据层）能够很好地示意整个高层抽象。展示层包含页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角如下图所示:

![逻辑视角](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/logicView.jpg?raw=true)

逻辑设计方案如下图所示:

![逻辑设计方案](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/softwareArchitecture.jpg?raw=true)

## 4. 组合视图

### 4.1 开发包图

| 开发包 | 依赖的其他开发包|
| :-: | - |
| mainui | http,vo |
| userui | http,vo |
| manageui | http,vo |
| clientui | http,vo |
|userblservice|http|
|saleblservice|http|
|movieblservice|http|
|vipcardblservice|http|
|cinemablservice|http|
| http ||
|userbl| userdataservice,po|
|salebl| saledataservice,moviebl,userbl,vipcardbl,po|
|moviebl|moviedataservice,userbl,po|
|vipcardbl|vipcarddataservice,userbl,po|
|cinemabl| moviebl,cinemadataservice,po|
|utilitybl||
|userdataservice|po|
|saledataservice|po|
|moviedataservice|po|
|cinemadataservice|po|
|vipcarddataservice|po|
|userdata|po,databaseutility|
|saledata|po,databaseutility|
|moviedata|po,databaseutility|
|cinemadata|po,databaseutility|
|vipcarddata|po,databaseutility|
|datautility|JDBC|
|vo|Jackson,Form|
|po||

影院管理系统客户端开发图如下图所示:

![客户端开发图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/clientSDK.jpg?raw=true)

服务器端开发包图如下图所示:

![服务器端开发包图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/serverSDK.jpg?raw=true)

### 4.2 运行时进程

影院管理系统中会有一个服务器端进程和多个客户端进程，客户端进程在浏览器上运行，服务器端进程在服务器端机器运行。

进程图如图所示:

![进程图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/processDiagram.jpg?raw=true)

### 4.3 物理部署

影院管理系统客户端构件放在浏览器上，服务器端构件放在服务器端机器上。

部署图如图所示:

![部署图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/deploymentDiagram.jpg?raw=true)

## 5. 架构设计

### 5.1 模块职责

客户端模块视图如图所示
![客户端模块视图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/clientModule.jpg?raw=true)
服务器端模块视图如图所示
![服务器端模块视图](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/serverModule.jpg?raw=true)

#### 5.1.1 各层职责

##### 客户端

|层| 职责|
| :-: | - |
| 用户展示层 | 基于web页面的影院管理系统客户端用户界面 |
| 客户端网络模块 | 利用http通信协议进行http通信 |

##### 服务端

|层| 职责|
| :------------: | -------------------------------------------------------- |
|启动模块| 负责初始化网络通信机制|
|   业务逻辑层   | 对于客户端的http请求进行响应、进行业务逻辑处理并返回页面 |
|数据层| 负责数据的持久化及数据访问接口|
| 服务端网络模块 | 利用http通信协议进行http通信|

##### 层之间调用接口

| 接口  | 服务调用方   | 服务提供方|
| :-: | - | - |
| UserBLService | 客户端展示层 | 服务器端业务逻辑层 |
| CinemaBLService| 同上 | 同上 |
| SaleBLService| 同上 | 同上 |
| MovieBLService| 同上 | 同上 |
| VipcardBLService| 同上 | 同上 |
||||
|UserMapper|服务器端业务逻辑层|服务器端数据层|
|SaleMapper|同上|同上|
|MovieMapper|同上|同上|
|VIPcardMapper|同上|同上|
|DatabaseFactory|同上|同上|

用户用例层之间调用的接口如图所示：

![用户用例层之间调用的接口](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/UserInterfaceUse.jpg?raw=true)

电影用例层之间调用的接口如图所示：

![电影用例层之间调用的接口](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/MovieInterfaceUse.jpg?raw=true)

销售用例层之间调用的接口如图所示：

![销售用例层之间调用的接口](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/SaleInterfaceUse.jpg?raw=true)

影院用例层之间调用的接口如图所示：

![影院用例层之间调用的接口](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/CinemaInterfaceUse.jpg?raw=true)

会员卡用例层之间调用的接口如图所示：

![会员卡用例层之间调用的接口](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/VipcardInterfaceUse.jpg?raw=true)

### 5.2 用户界面层分解

根据需求，系统存在20个用户界面：注册界面、登录界面、管理员主界面、观众主界面、影院员工主界面、管理员电影管理界面、管理员统计主界面、管理员单部电影统计界面、观众排片查询界面、观众会员卡界面、观众票务界面、影院员工排片管理界面、影院员工排片查询界面、影院员工统计主界面、影院员工单部电影统计界面、影院员工优惠活动管理界面、影院员工电影管理界面、搜索界面、已上架电影界面、电影详情界面。

界面跳转如图所示:

![用户界面跳转](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/pageJumps.jpg?raw=true)

#### 5.2.1 职责

| 模块| 职责|
| ----------- | -------------------------------------- |
| MainFrame   | 登录页面，负责界面的显示和界面的跳转   |
| UserFrame   | 观众页面，负责界面的显示和界面的跳转   |
| ManageFrame | 管理员页面，负责界面的显示和界面的跳转 |
| ClientFrame | 管理员页面，负责界面的显示和界面的跳转 |

#### 5.2.2 接口规范

| 接口名 |||
| - | :- |-|
| MainFrame.loginPage |语法|```GET /login```|
||前置条件|无|
||后置条件|进入登录界面|
| MainFrame.login |语法|```POST /login```|
||前置条件|用户未登录，password符合输入规范|
||后置条件|查找是否存在相应的User，根据输入的password返回登录验证的结果，跳转至对应的Frame|
|MainFrame.registerPage|语法|```GET /register```|
||前置条件|无|
||后置条件|进入注册界面|
|MainFrame.register|语法|```POST /register```|
||前置条件|无|
||后置条件|查找username没有重复,用户信息符合规范，返回注册结果|
|/*Frame.logout|语法|```POST /logout```|
||前置条件|用户已登录|
||后置条件|无|
|UserFrame.movieDetail|语法|```GET /user/movie/{movieId}```|
||前置条件|用户已登录|
||后置条件|跳转至对应电影详细页面|
|UserFrame.movies|语法|```GET /user/movie```|
||前置条件|用户已登录|
||后置条件|跳转至所有上架电影页面|
|UserFrame.search|语法|```GET /user/movie/search```|
||前置条件|用户已登录|
||后置条件|跳转至所有符合搜索条件的电影界面|
|UserFrame.movieArrangement|语法|```GET /user/arrangement/get```|
||前置条件|用户已登录|
||后置条件|跳转至电影排片界面|
|UserFrame.arrangement|语法|```GET /user/seat/get```|
||前置条件|用户已登录|
||后置条件|跳转至某场排片的详情界面|
|UserFrame.lockSeats|语法|```POST /user/ticket/lockSeats/{arrangementId}```|
||前置条件|用户已登录且在该场次没有未完成订单|
||后置条件|生成订单，跳转至支付界面|
|UserForm.payByVIPCard|语法|```POST /user/vip/pay/{orderID}```|
||前置条件|用户可以支付这个订单|
||后置条件|系统处理用户的支付|
|UserForm.payByAlipay|语法|```POST /user/alipay/pay/{orderID}```|
||前置条件|用户可以支付这个订单|
||后置条件|系统请求第三方支付，等待第三方支付的结果|
|UserForm.refund|语法|```POST /user/ticket/refund```|
||前置条件|用户可以退这张票|
||后置条件|系统为用户处理退票|
|UserFrame.buyPage|语法|```GET /user/buy```|
||前置条件|用户已登录|
||后置条件|跳转至购票界面|
|UserForm.cardPocket|语法|```GET /user/cardPocket```|
||前置条件|用户已登录|
||后置条件|跳转至卡包界面|
|UserForm.buyCard|语法|```POST /user/vip/card/add```|
||前置条件|用户已登录且没有会员卡|
||后置条件|系统处理用户的购卡|
|UserForm.deposit|语法|```POST /user/vip/deposit```|
||前置条件|用户已登录且已经有会员卡|
||后置条件|系统处理用户的充值|
|UserForm.consumeRecordPage|语法|```GET /user/consumeRecord```|
||前置条件|用户已登录|
||后置条件|跳转至消费记录界面|
|UserForm.purchaseRecordPage|语法|```GET /user/purchaseRecord```|
||前置条件|用户已登录|
||后置条件|跳转至消费记录界面|
|UserForm.RechargeRecord|语法|```GET /user/rechargeRecord```|
||前置条件|用户已登录|
||后置条件|跳转至充值记录界面|
|UserFrame.index|语法|```GET /user/home```|
||前置条件|用户已登录|
||后置条件|跳转至观众主界面|
|UserFrame.like|语法|```POST /user/movie/like/{movie_id}```|
||前置条件|用户已登录|
||后置条件|上传点击想看的信息，显示点击想看操作的结果|
|UserFrame.unlike|语法|```POST /user/movie/unlike/{movie_id}```|
||前置条件|用户已登录|
||后置条件|上传点击想看的信息，显示点击想看操作的结果|
|UserFrame.vipcard|语法|```GET /user/vip/card/get```|
||前置条件|用户已登录|
||后置条件|跳转至观众会员卡信息界面|
|UserFrame.purchaseVip|语法|```GET /user/vip/card/add```|
||前置条件|用户已登录|
||后置条件|跳转至观众会员卡购买界面|
|UserFrame.chargeVip|语法|```GET /user/vip/deposit```|
||前置条件|用户已登录，且持有会员卡|
||后置条件|跳转至观众会员卡充值界面|
|UserFrame.buyTicket|语法|```GET /user/seat/get```|
||前置条件|用户已登录|
||后置条件|跳转至选座界面|
|UserFrame.tickets|语法|```GET /user/purchaseRecord```|
||前置条件|用户已登录|
||后置条件|跳转至已购电影票界面|
|ManageFrame.index|语法|```GET /manage```|
||前置条件|管理员已登录|
||后置调价|跳转至管理员主界面|
|ManageFrame.releaseInit|语法|```GET /manage/movie```|
||前置条件|管理员已登录|
||后置条件|跳转至电影管理界面|
|ManageFrame.release|语法|```POST /manage/add```|
||前置条件|管理员已登录，输入了符合规范的影片信息|
||后置条件|上传电影信息，显示上架结果|
|ManageFrame.modify|语法|```POST /manage/modify```|
||前置条件|管理员已登录，输入了符合规范的影片信息|
||后置条件|上传电影信息，显示修改结果|
|ManageFrame.release|语法|```POST /manage/remove```|
||前置条件|管理员已登录，电影存在|
||后置条件|显示下架结果|
|ManageFrame.statistics|语法|```GET /manage/statistics```|
||前置条件|管理员或影院员工已登录|
||后置条件|跳转至电影统计界面|
|ManageFrame.manageArrangementInit|语法|```GET /manage/arrangement```|
||前置条件|影院员工已登录|
||后置条件|跳转至排片管理的界面|
|ManageFrame.addArrangement|语法|```POST /manage/arrangement/add```|
||前置条件|影院员工已登录|
||后置条件|上传排片信息，显示排片结果|
|ManageFrame.modifyArrangement|语法|```POST /manage/arrangement/modify```|
||前置条件|影院员工已登录，存在目标排片|
||后置条件|上传排片信息，显示修改排片结果|
|ManageFrame.removeArrangement|语法|```POST /manage/arrangement/remove```|
||前置条件|影院员工已登录，存在目标排片|
||后置条件|显示删除排片结果|
|AdminFrame.discountInit|语法|```GET /admin/promotion/get```|
||前置条件|影院管理员已登录|
||后置条件|跳转至优惠活动管理界面|
|AdminFrame.releaseDiscount|语法|```POST /admin/promotion/add```|
||前置条件|影院管理员已登录|
||后置条件|显示发布优惠活动的结果|
|AdminFrame.addRefundStrategy|语法|```POST /admin/refund/add```|
||前置条件|影院管理员已登录|
||后置条件|显示发布退票策略的结果|
|AdminFrame.modifyRefundStrategy|语法|```POST /admin/refund/modify```|
||前置条件|影院管理员已登录，退票策略存在|
||后置条件|显示修改退票策略的结果|
|AdminFrame.addHall|语法|```POST /admin/hall/add```|
||前置条件|影院管理员已登录|
||后置条件|显示新增影厅的结果|
|AdminFrame.modifyHall|语法|```POST /admin/hall/modify```|
||前置条件|影院管理员已登录，影厅存在|
||后置条件|显示修改影厅的结果|
|AdminFrame.addReduction|语法|```POST /admin/vip/reduction/add```|
||前置条件|影院管理员已登录|
||后置条件|显示新增充值优惠的结果|
|AdminFrame.modifyReduction|语法|```POST /admin/vip/reduction/modify```|
||前置条件|影院管理员已登录，充值优惠存在|
||后置条件|显示修改充值优惠的结果|
|AdminFrame.addReduction|语法|```POST /admin/vip/reduction/delete```|
||前置条件|影院管理员已登录，充值优惠存在|
||后置条件|显示删除充值优惠的结果|
|AdminFrame.presentCoupon|语法|```POST /admin/vip/presentCoupon```|
||前置条件|影院管理员已登录|
||后置条件|显示赠送优惠券的结果|
|RootFrame.addStaff|语法|```POST /root/addStaff```|
||前置条件|影院管理员已登录|
||后置条件|显示新增员工的结果|
|RootFrame.removeStaff|语法|```POST /root/removeStaff```|
||前置条件|影院管理员已登录，存在目标员工|
||后置条件|显示删除员工的结果|
|RootFrame.changeStaffRole|语法|```POST /root/changeRole```|
||前置条件|影院管理员已登录，存在目标员工|
||后置条件|显示修改员工角色的结果|

|服务名| 服务|
| :-: | - |
| \*blservice.\*BLService| 每个界面都有一个相应的业务逻辑接口|

### 5.3 业务逻辑层分解

业务逻辑层的设计如下图所示
![业务逻辑层的设计](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/businessLogic.jpg?raw=true)

#### 5.3.1 职责

| 模块| 职责|
| --------- | ---------------------------------------------- |
| userbl| 负责实现对应与注册、登录和登出页面所需要的服务 |
| salebl| 负责实现购票、优惠、统计数据所需要的服务|
| moviebl   | 负责实现电影界面所需要的服务|
| cinemabl  | 负责实现排片、选座所需要的服务|
| vipcardbl | 负责实现购买、查看、充值会员卡所需要的服务|

#### 5.3.2 接口规范

##### 表 userbl模块的接口规范

|提供的服务（供接口）|||
|-|-|-|
|User.login|语法|```public Response login(UserVO userForm)```|
||前置条件|用户未登录，userForm中的信息符合规范|
||后置条件|查找是否存在相应的User，根据userForm.password返回验证的结果给展示层|
|User.register|语法|```public Response register(RegistryForm registryForm)```|
||前置条件|newUserForm中的信息符合规范|
||后置条件|检查是否存在同名用户，返回注册的结果给展示层|
|User.logout|语法|```public Response logout()```|
||前置条件|用户已登录|
||后置条件|返回登出的结果给展示层|
|User.getUserByUserId|语法|```public User getUserByID(int ID);```|
||前置条件|无|
||后置条件|返回具有此id的UserPO|
|User.getUserVOByName|语法|```public UserVO getUserVOByName(String name);```|
||前置条件|无|
||后置条件|返回此名字的UserVO|
|User.getStaff|语法|```public Response getStaff(List<String> query);```|
||前置条件|无|
||后置条件|返回含有员工列表的vo.Response|
|User.addStaff|语法|```public Response addStaff(StaffForm staffForm);```|
||前置条件|无|
||后置条件|返回添加的员工信息|
|User.addManager|语法|```public Response addManager(StaffForm staffForm);```|
||前置条件|无|
||后置条件|返回添加的经理信息|
|User.changeRole|语法|```public Response changeRole(StaffForm staffForm);```|
||前置条件|无|
||后置条件|返回修改角色后的员工信息|

|需要的接口（需接口）||
|-|-|
|服务名|服务|
|DataBaseFactory.getUserDatabase|使用User数据库的服务的引用|
|UserMapper.insertSelective(User record)|在数据库中插入一个用户对象|
|UserMapper.deleteByPrimaryKey(Integer id)|在数据库中删除一个用户对象|
|UserMapper.updateByPrimaryKeySelective(User record)|在数据库中修改一个用户对象|
|UserMapper.selectByName(String name)|根据用户名获得相应的用户对象|
|UserMapper.selectAllStaff()|获得所有员工对象|
|UserMapper.selectAllManager()|获得所有经理对象|
|UserMapper.selectStaffByName(String name)|根据用户名获得一个员工对象|
|UserMapper.selectManagerByName(String name)|根据用户名获得一个经理对象|
|RoleMapper.deleteByPrimaryKey(Integer id)|删除一个角色对象|
|RoleMapper.insertSelective(Role record)|插入一个角色对象|
|RoleMapper.selectByPrimaryKey(Integer id)|获得一个角色对象|
|RoleMapper.selectRoleByName(String roleName)|根据角色名字一个角色对象|
|RoleMapper.updateByPrimaryKeySelective(Role record)|修改一个角色对象|
|UserHasRoleMapper.insertSelective(UserHasRoleKey record)|给用户添加角色|
|UserHasRoleMapper.deleteByUserID(int userID)|删除用户的角色|
|UserHasRoleMapper.updateByUserID(UserHasRoleKey record)|修改用户的角色|
|UserHasRoleMapper.selectByUserID(int userID)|获得用户的角色|

##### 表 salebl模块的接口规范

| 提供的服务（供接口）|||
| - | - | - |
| Sale.publishPromotion| 语法| ```public Response publishPromotion(PromotionForm promotionForm)```  |
|| 前置条件 | 管理员请求发布优惠活动|
|| 后置条件 | 系统返回优惠活动发布结果给展示层并更新优惠策略|
| Sale.getAllPromotions| 语法| ```public Response getAllPromotions()```  |
|| 前置条件 | 管理员请求查看所有优惠活动|
|| 后置条件 | 系统返回所有优惠活动|
|Sale.getAvailableCouponsByUser|语法|```public Response getAvailableCouponsByUser(int userId)```|
||前置条件|用户请求查看自己可用的优惠券|
||后置条件|系统返回用户的所有可用的优惠券|
|Sale.lockSeat|语法|```public Response lockSeat(List<Integer> seatID, int userID, int arrangementID)```|
||前置条件|用户锁座前购票|
||后置条件|系统返回用户锁座后生成的订单|
|Sale.payable|语法|```public Response payable(long orderID, int couponID, int userID)```|
||前置条件|用户请求支付订单|
||后置条件|返回用户是否能否支付|
|Sale.payOrder|语法|```public Response payOrder(long orderID, float amount)```|
||前置条件|用户能够支付订单|
||后置条件|返回支付结果|
|Sale.payOrderByVIPCard|语法|```public Response payOrderByVIPCard(long orderID, int userID)```|
||前置条件|用户请求用会员卡支付订单并能够用会员卡支付订单|
||后置条件|返回支付结果|
|Sale.cancelOrder|语法|```public Response cancelOrder(int userID, long orderID)```|
||前置条件|用户请求取消订单|
||后置条件|返回取消结果|
|Sale.refundTicket|语法|```public Response refundTicket(int userID, int ticketID)```|
||前置条件|用户请求退票|
||后置条件|返回退票结果|
|Sale.getOrderByScheduleIdAndUserId|语法|```public Response getOrderByScheduleIdAndUserId(int userId, int scheduleId)```|
||前置条件|用户进入一场排片|
||后置条件|系统返回用户此前在该场排片是否有未完成订单|
|Sale.getHistoricalConsumptionsByUserId|语法|```public Response getHistoricalConsumptionsByUserId(int userId)```|
||前置条件|用户选择查看自己的历史消费记录|
||后置条件|系统返回用户的历史消费记录|
|Sale.addRefundTicketManage|语法|```public Response addRefundTicketManage(RefundStrategyForm refundStrategyForm)```|
||前置条件|用户请求新增退票策略|
||后置条件|系统返回新增结果|
|Sale.modifyRefundTicketManage|语法|```public Response modifyRefundTicketManage(RefundStrategyForm refundStrategyForm)```|
||前置条件|用户请求修改退票策略|
||后置条件|系统返回修改结果|
|Sale.getAllRefunds|语法|```public  Response getAllRefunds()```|
||前置条件|用户请求获得所有退票策略|
||后置条件|系统返回所有退票策略|

| 需要的服务（需接口）||
| - | - |
|服务名|服务|
|PromotionMapper.insertSelective(Promotion record)|插入一个活动对象|
|PromotionMapper.deleteByPrimaryKey(Integer id)|删除一个活动对象|
|PromotionMapper.updateByPrimaryKeySelective(Promotion record)|修改一个活动对象|
|PromotionMapper.selectByPrimaryKey(Integer id)|根据ID查找一个活动对象|
|PromotionMapper.selectAll()|查找所有活动对象|
|CouponMapper.insertSelective(Coupon record)|插入一个优惠券对象|
|CouponMapper.deleteByPrimaryKey(Integer id)|删除一个优惠券对象|
|CouponMapper.selectByPrimaryKey(Integer id)|根据ID返回一个优惠券对象|
|CouponMapper.selectByUserID(int userID)|返回用户的所有优惠券|
|PromotionHasMovieMapper.insertSelective(PromotionHasMovie record)|给活动对象插入适用的电影对象|
|PromotionHasMovieMapper.deleteByPrimaryKey(PromotionHasMovie key)|给活动对象删除一个适用的电影对象|
|PromotionHasMovieMapper.selectByPromotionID(int promotionID)|返回该活动的所有电影|
|PromotionHasMovieMapper.selectByMovieID(Integer movieID)|返回适用电影的所有活动|
|TicketMapper.insertSelective(Ticket record)|插入一个电影票对象|
|TicketMapper.deleteByPrimaryKey(Integer id)|删除一个电影票对象|
|TicketMapper.updateByPrimaryKeySelective(Ticket record)|修改一个电影票对象|
|TicketMapper.selectByPrimaryKey(Integer id)|获得一个电影票对象|
|TicketMapper.selectByUserID(int userID)|获得用户的所有电影票|
|TicketMapper.selectByOrderID(long orderID)|获得该订单包含的所有电影票|
|TicketMapper.selectByMovieID(int movieID)|获得该电影的所有电影票|
|TicketMapper.selectByArrangementID(int arrangementID)|获得该场排片的所有电影票|
|TicketMapper.selectByDate(Date startDate, Date endDate)|获得时间段内的所有电影票|
|RefundStrategyMapper.insertSelective(RefundStrategy record)|插入一个退票策略对象|
|RefundStrategyMapper.deleteByPrimaryKey(Integer day)|删除一个退票策略对象|
|RefundStrategyMapper.updateByPrimaryKeySelective(RefundStrategy record)|修改一个退票策略对象|
|RefundStrategyMapper.selectByPrimaryKey(Integer day)|获得一个退票策略对象|
|RefundStrategyMapper.selectAll()|获得所有的退票策略对象|
|OrderMapper.insertSelective(Order record)|插入一个订单对象|
|OrderMapper.deleteByPrimaryKey(Long id)|删除一个订单对象|
|OrderMapper.updateByPrimaryKeySelective(Order record)|修改一个订单对象|
|OrderMapper.selectByPrimaryKey(Long id)|获得一个订单对象|

##### 表 moviebl模块的接口规范

| 提供的服务（供接口) |||
| ------------------- | -------- | ---------------------------------------------------- |
|movie.getMovie|语法|```public Response getMovie(int movieID, int userID)```|
||前置条件|用户请求查询电影|
||后置条件|系统返回相应的电影或者所有电影，电影里包含了用户是否想看该电影的信息|
|movie.searchMovies|语法|```public Response searchMovies(String query,int userID)```|
||前置条件|用户请求搜索电影|
||后置条件|系统返回符合条件的电影|
|movie.like|语法|```public Response like(int userID, int movieID)```|
||前置条件|用户请求标记电影为想看|
||后置条件|系统返回标记结果|
|movie.unlike|语法|```public Response unlike(int userID, int movieID)```|
||前置条件|用户请求取消标记想看电影|
||后置条件|系统返回取消结果|
|movie.addMovie|语法|```public Response addMovie(MovieForm movieForm)```|
||前置条件|用户请求上架电影|
||后置条件|系统返回上架结果|
|movie.modifyMovie|语法|```public Response modifyMovie(MovieForm movieForm)```|
||前置条件|用户请求修改电影|
||后置条件|系统返回修改结果|
|movie.removeMovie|语法|```public Response removeMovie(int movieID)```|
||前置条件|用户请求下架电影|
||后置条件|系统返回下架结果|
|movie.getMovie|语法|```public Response getMovie(int movieID)```|
||前置条件|用户请求查询电影|
||后置条件|系统返回该电影或全部电影|

| 需要的服务（需接口）||
| ---------------------------------------- | -------------------------------- |
| 服务名| 服务|
|MovieMapper.insertSelective(Movie record)|插入一个电影对象|
|MovieMapper.deleteByPrimaryKey(Integer id)|删除一个电影对象|
|MovieMapper.updateByPrimaryKeySelective(Movie record)|更新一个电影对象|
|MovieMapper.selectByPrimaryKey(Integer id)|获得一个电影对象|
|MovieMapper.selectAll()|获得所有的电影对象|
|MovieMapper.query(String query)|获得符合条件的所有电影对象|
|MovieLikeMapper.insertSelective(MovieLike record)|插入一条想看记录|
|MovieLikeMapper.deleteByUserAndMovie(MovieLike record)|删除一条想看记录|
|MovieLikeMapper.selectByUserAndMovie(MovieLike record)|获得一条想看记录|
|MovieLikeMapper.selectByMovieID(int movieID)|获得该电影的所有想看记录|
|MovieLikeMapper.selectByMovieGroupByDate(int movieID)|按时间获得该电影的所有想看记录|
|MovieLikeMapper.selectByUserID(int userID)|获得该用户的所有想看记录|
|DatabaseFacory.getMovieDatabase| 得到Movie数据库的服务的引用|

##### 表 Cinemabl模块的接口规范

| 提供的服务（供接口）|||
| - | - | - |
|Cinema.inputHallInfo|语法|```public Response inputHallInfo(HallForm hallForm)```|
||前置条件|用户请求增加影厅|
||后置条件|系统返回结果|
|Cinema.modifyHallInfo|语法|```public Response modifyHallInfo(HallForm hallForm, int ID)```|
||前置条件|用户请求修改影厅信息|
||后置条件|系统返回结果|
|Cinema.getAllHallInfo|语法|```public Response getAllHallInfo()```|
||前置条件|用户请求查看所有影厅信息|
||后置条件|系统返回所有影厅信息|
|Cinema.getByMovieID|语法|```public Response getByMovieID(int movieID)```|
||前置条件|用户请求查看该电影的排片|
||后置条件|系统返回排片|
|Cinema.getSeatMap|语法|```public Response getSeatMap(int aID)```|
||前置条件|用户点进某场排片|
||后置条件|系统显示该场排片的座位|
|Cinema.addArrangement|语法|```public Response addArrangement(ArrangementForm arrangementForm)```|
||前置条件|用户请求新增排片|
||后置条件|系统返回结果|
|Cinema.modifyArrangement|语法|```public Response modifyArrangement(ArrangementForm arrangementForm, int ID)```|
||前置条件|用户请求修改排片|
||后置条件|系统返回结果|
|Cinema.removeArrangement|语法|```public Response removeArrangement(int ID)```|
||前置条件|用户请求删除排片|
||后置条件|系统返回结果|
|Cinema.getArrangementsByHallID|语法|```public Response getArrangementsByHallID(int hallID, Date startDate)```|
||前置条件|用户请求获得该影厅的所有排片|
||后置条件|系统返回相应排片|
|Cinema.modifyVisibleDay|语法|```public Response modifyVisibleDay(List<Integer> IDs, Date date)```|
||前置条件|用户请求修改排片的可见时间|
||后置条件|系统返回结果|
|Cinema.getArrangementsByDay|语法|```public Response getArrangementsByDay(Date startDate, Date endDate)```|
||前置条件|用户请求获得两个时间段内的所有排片|
||后置条件|系统返回相应排片|

| 需要的服务（需接口）||
| - | - |
|服务名|服务|
|HallMapper.insertSelective(Hall record)|插入一个影厅对象|
|HallMapper.deleteByPrimaryKey(Integer id)|删除一个影厅对象|
|HallMapper.updateByPrimaryKeySelective(Hall record)|更新一个影厅对象|
|HallMapper.selectByPrimaryKey(Integer id)|获得一个影厅对象|
|HallMapper.selectAll()|获得所有影厅对象|
|SeatMapper.insertSelective(Seat record)|插入一个座位对象|
|SeatMapper.deleteByPrimaryKey(Integer id)|删除一个座位对象|
|SeatMapper.updateByPrimaryKeySelective(Seat record)|更新一个座位对象|
|SeatMapper.selectByPrimaryKey(Integer id)|获得一个座位对象|
|SeatMapper.selectByHallID(int hallID)|获得该影厅的所有座位对象|
|SeatMapper.deleteByHallID(int hallID)|删除该影厅的所有座位对象|
|ArrangementMapper.insertSelective(Arrangement record)|插入一个排片对象|
|ArrangementMapper.deleteByPrimaryKey(Integer id)|删除一个排片对象|
|ArrangementMapper.updateByPrimaryKeySelective(Arrangement record)|更新一个排片对象|
|ArrangementMapper.selectByPrimaryKey(Integer id)|获得一个排片对象|
|ArrangementMapper.selectByMovieID(int movieID)|获得该电影的所有排片对象|
|ArrangementMapper.selectByHallIDAndStartDate( int hallID,Date startDate, int duration)|返回在开始时间后该影厅的所有排片|
|ArrangementMapper.selectByDay(Date startDay,Date endDay)|返回时间段内的所有排片|
|ArrangementSeatMapper.insertSelective(ArrangementSeat record)|插入一个排片座位对象|
|ArrangementSeatMapper.delete(ArrangementSeat record)|删除一个排片座位对象|
|ArrangementSeatMapper.updateSeatStatus(ArrangementSeat record)|更新一个排片座位对象|
|ArrangementSeatMapper.select(ArrangementSeat record)|获得一个排片座位对象|
|ArrangementSeatMapper.selectByArrangementID(int arrangementId)|获得该场排片的所有排片座位对象|

##### 表 VIPCardbl模块的接口规范

|提供的服务（供接口)|||
|-|-|-|
|VIPCard.getAllVIPs|语法|```public Response getVIPs()```|
||前置条件|用户请求获取所有的VIP用户|
||后置条件|系统返回所有的VIP用户|
|VIPCard.getVIPs|语法|```public Response getVIPs(double money)```|
||前置条件|用户请求获取消费满一定金额的VIP用户|
||后置条件|系统返回相应的VIP用户|
|VIPCard.presentCoupon|语法|```public Response presentCoupon(List<Integer> vips, List<Integer> couponIDs)```|
||前置条件|管理员需要给VIP用户送优惠券|
||后置条件|系统返回赠送结果|
|VIPCard.addReduction|语法|```public Response addReduction(RechargeReductionVO reductionVO)```|
||前置条件|用户增加充值优惠策略|
||后置条件|系统返回结果|
|VIPCard.modifyReduction|语法|```public Response modifyReduction(RechargeReductionVO reductionVO)```|
||前置条件|用户修改充值优惠策略|
||后置条件|系统返回结果|
|VIPCard.removeReduction|语法|```public Response removeReduction(int id)```|
||前置条件|用户删除充值优惠策略|
||后置条件|系统返回结果|
|VIPCard.getVIPCard|语法|```public Response getVIPCard(int userID)```|
||前置条件|用户请求获得自己的会员卡对象|
||后置条件|系统返回相应的会员卡对象|
|VIPCard.addVIPCard|语法|```public Response  addVIPCard(int userID)```|
||前置条件|用户请求购买会员卡|
||后置条件|系统返回购买结果|
|VIPCard.getRechargeReduction|语法|```public Response getRechargeReduction()```|
||前置条件|用户请求查看所有的充值优惠|
||后置条件|系统返回充值优惠|
|VIPCard.getRechargeHistory|语法|```public Response getRechargeHistory(int userID)```|
||前置条件|用户请求查看充值记录|
||后置条件|系统返回自己的充值记录|
|VIPCard.addVIPBalance|语法|```public Response addVIPBalance(int userID, float amount)```|
||前置条件|用户请求退自己用会员卡购买的票|
||后置条件|系统返回结果|
|VIPCard.depositable|语法|```public Response depositable(int userID, float amount)```|
||前置条件|用户请求充值|
||后置条件|系统返回用户能否充值|
|VIPCard.deposit|语法|```public Response deposit(int userID, String orderID)```|
||前置条件|用户能充值并且请求充值|
||后置条件|系统返回结果|
|VIPCard.pay|语法|```public Response pay(int userID, float amount)```|
||前置条件|用户请求用会员卡购票|
||后置条件|系统返回结果|

|需要的服务（需接口）||
|-|-|
|服务名|服务|
|VipcardMapper.insertSelective(Vipcard record)|插入一个会员卡对象|
|VipcardMapper.deleteByPrimaryKey(Integer userId)|删除一个会员卡对象|
|VipcardMapper.updateByPrimaryKeySelective(Vipcard record)|更新一个会员卡对象|
|VipcardMapper.selectByPrimaryKey(Integer userId)|获取一个会员卡对象|
|VipcardMapper.selectAll()|获取所有会员卡对象|
|TradeRecordMapper.insertSelective(TradeRecord record)|插入一个充值记录对象|
|TradeRecordMapper.deleteByPrimaryKey(Integer id)|删除一个充值记录对象|
|TradeRecordMapper.selectByPrimaryKey(Integer id)|获取一个充值记录对象|
|TradeRecordMapper.selectByUserID(Integer userID)|获取该用户的所有充值记录对象|
|VipcardRechargeReductionMapper.insertSelective(VipcardRechargeReduction record)|插入一个充值优惠对象|
|VipcardRechargeReductionMapper.deleteByPrimaryKey(Integer targetAmount)|删除一个充值优惠对象|
|VipcardRechargeReductionMapper.updateByPrimaryKeySelective(VipcardRechargeReduction record)|更新一个充值优惠对象|
|VipcardRechargeReductionMapper.selectByPrimaryKey(Integer targetAmount)|获得一个或全部充值优惠对象|
|VipcardRechargeReductionMapper.selectByAmount(Float amount)|获得最适合该充值金额的充值优惠对象|

##### 表 Statisticsbl模块的接口规范

|提供的服务（供接口)|||
|-|-|-|
|Statistics.getScheduleRateByDate|语法|```public Response getScheduleRateByDate(Date date)```|
||前置条件|用户请求获得排片率|
||后置条件|系统返回排片率|
|Statistics.getTotalBoxOffice|语法|```public Response getTotalBoxOffice()```|
||前置条件|用户请求获得总票房|
||后置条件|系统返回总票房|
|Statistics.getAudiencePrice|语法|```public Response getAudiencePrice(int days)```|
||前置条件|用户请求获得客单价|
||后置条件|系统返回客单价|
|Statistics.getMoviePlacingRateByDate|语法|```public Response getMoviePlacingRateByDate(Date date)```|
||前置条件|用户请求获得电影排片率|
||后置条件|系统返回电影排片率|
|Statistics.getPopularMovies|语法|```public Response getPopularMovies(int days, int movieNum)```|
||前置条件|用户请求获得最受欢迎电影列表|
||后置条件|系统返回最受欢迎列表|

|需要的服务（需接口）||
|-|-|
|服务名|服务|
|ticketStatistics.getAudiencePriceByDay|通过日期获得客单价|
|ticketStatistics.getNumOfTicketsByArrangement|获得该场排片的已出售的票数|
|ticketStatistics.getBoxOfficeByMovieIDAndDay|通过电影ID和日期获得票房|
|arrangementManage.getArrangementsByDay|获得时间段内的排片|
|movieManagement.getReleasedMovies|获得已上映的电影|
|movieManagement.getMovieByID|通过电影ID获得电影对象|
|hallManage.getSeatNumByHallID|通过影厅ID获得影厅的座位数|

### 5.4 数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。

数据层VipcardeDataService的模块如下图所示:

![VipcardeDataService的描述](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/VipcardMapper.jpg?raw=true)

数据层MovieDataService的模块如下图所示：

![MovieDataService的描述](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/MovieMapper.jpg?raw=true)

数据层CinemaDataService的模块如下图所示：

![CinemaDataService的描述](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/CinemaMapper.jpg?raw=true)

数据层SaleDataService的模块如下图所示：

![SaleDataService的描述](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/SaleMapper.jpg?raw=true)

数据层UserDataService的模块如下图所示：

![UserDataService的描述](https://github.com/Translucentwall/UMLImage/blob/master/docTask3/UserMapper.jpg?raw=true)

#### 5.4.1 职责

VipcardDataService的职责如下表所示

| 模块| 职责|
| --------- | ---------------- |
| VipcardDataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

MovieDataService的职责如下表所示

| 模块| 职责|
| --------- | ------------------------------------ |
| MovieDataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

SaleDataService的职责如下表所示

| 模块| 职责|
| --- | ---------------- |
| SaleDataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

CinemaDataService的职责如下表所示

| 模块| 职责|
| ------------ | -------------- |
| CinemaDataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

UserDataService的职责如下表所示

| 模块| 职责|
| ------------ | ----------------------------------- |
| UserDataService | 持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

#### 5.4.2 接口规范

##### 表 UserDataService接口规范

| 提供的服务（供接口）|||
| -------- | -------- | -------------- |
| UserMapper.insertSelective| 语法| ```public int insertSelective(User record)```|
|| 前置条件 | 相同username或相同id的PO在数据库中不存在|
|| 后置条件 | 在数据库中增加一个PO记录|
| UserMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 相同id的PO在数据库中存在|
|| 后置条件 | 在数据库中删除一个PO记录|
| UserMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(User record)```|
|| 前置条件 | 相同username或相同id的PO在数据库中存在|
|| 后置条件 | 在数据库中更新一个PO记录|
| UserMapper.selectByPrimaryKey| 语法| ```public User selectByPrimaryKey(Integer id)```|
|| 前置条件 | 相同id的PO在数据库中存在|
|| 后置条件 | 返回一个PO记录|
| UserMapper.selectByName| 语法| ```public User selectByName(String name)```|
|| 前置条件 | 相同username的PO在数据库中存在|
|| 后置条件 | 返回一个PO记录|
| UserMapper. selectAllStaff| 语法| ```public List<Staff> selectAllStaff()```|
|| 前置条件 | 无|
|| 后置条件 | 返回所有的员工PO|
| UserMapper.selectAllManager| 语法| ```public List<Manager> selectAllManager()```|
|| 前置条件 | 无|
|| 后置条件 | 返回所有的经理PO|
| UserMapper.selectStaffByName| 语法| ```public Staff selectStaffByName(String name)```|
|| 前置条件 | 相同username的员工PO在数据库中存在|
|| 后置条件 | 返回一个员工PO|
| UserMapper.selectManagerByName| 语法| ```public selectManagerByName(String name)```|
|| 前置条件 | 相同username的经理PO在数据库中存在|
|| 后置条件 | 返回一个经理PO|
| UserMapper.init| 语法| ```public void init() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 初始化持久化数据库|
| UserMapper.finish| 语法| ```public void finish() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 结束持久化数据库的使用|
| RoleMapper.insertSelective| 语法| ```public int insertSelective(Role record)```|
|| 前置条件 | 相同id的PO在数据库中不存在|
|| 后置条件 | 在数据库中增加一个PO记录|
| RoleMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 相同id的PO在数据库中存在|
|| 后置条件 | 在数据库中删除一个PO记录|
| RoleMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(Role record)```|
|| 前置条件 | 相同id的PO在数据库中存在|
|| 后置条件 | 在数据库中更新一个PO记录|
|RoleMapper.selectByPrimaryKey| 语法| ```public Role selectByPrimaryKey(Integer id)```|
|| 前置条件 | 相同id的PO在数据库中存在|
|| 后置条件 | 返回一个PO记录|
|RoleMapper.selectRoleByName| 语法| ```public Role selectRoleByName(String role_name)```|
|| 前置条件 | 相同RoleName的PO在数据库中存在|
|| 后置条件 | 返回一个PO记录|
| UserHasRoleMapper.insertSelective| 语法| ```public int insertSelective(UserHasRoleKey record)```|
|| 前置条件 | 相同UserID的PO在数据库中不存在|
|| 后置条件 | 在数据库中增加一个PO记录|
| UserHasRoleMapper.deleteByUserID| 语法| ```public int deleteByUserID(int userID)```|
|| 前置条件 | 相同UserID的PO在数据库中存在|
|| 后置条件 | 在数据库中删除一个PO记录|
| UserHasRoleMapper.updateByUserID| 语法| ```public int updateByUserID(UserHasRoleKey record)```|
|| 前置条件 | 相同UserID的PO在数据库中存在|
|| 后置条件 | 在数据库中更新一个PO记录|
|UserHasRoleMapper.selectByUserID| 语法| ```public UserHasRoleKey selectByUserID(int userID)```|
|| 前置条件 | 相同UserID的PO在数据库中存在|
|| 后置条件 | 返回一个PO记录|

##### 表 MovieDataService的接口规范

MovieDataService的接口规范如下表所示

|提供的服务（供接口）|||
|-|-|-|
|MovieMapper.insertSelective|语法|```public int insertSelective(Movie record)```|
||前置条件|无|
||后置条件|插入一个MoviePO对象|
|MovieMapper.deleteByPrimaryKey|语法|```public int deleteByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|删除一个MoviePO对象|
|MovieMapper.updateByPrimaryKeySelective|语法|```public int updateByPrimaryKeySelective(Movie record)```|
||前置条件|无|
||后置条件|更新一个MoviePO对象|
|MovieMapper.selectAll|语法|```public List<Movie> selectAll()```|
||前置条件|无|
||后置条件|获取所有的MoviePO|
|MovieMapper.query|语法|```public List<Movie> query(String query)```|
||前置条件|无|
||后置条件|获取符合参数条件的MoviePO|
|MovieMapper.|语法|```public ```|
||前置条件|无|
||后置条件||
|MovieMapper.init|语法|```public void init() throws Exception```|
||前置条件|无|
||后置条件|初始化持久化数据库|
|MovieMapper.finish|语法|```public void finish() throws Exception```|
||前置条件|无|
||后置条件|结束持久化数据库的引用|
|MovieLikeMapper.insertSelective|语法|```public int insertSelective(MovieLike record)```|
||前置条件|无|
||后置条件|插入一个MovieLikePO对象|
|MovieLikeMapper.deleteByUserAndMovie|语法|```public int deleteByUserAndMovie(MovieLike record)```|
||前置条件|无|
||后置条件|删除一个MovieLikePO对象|
|MovieLikeMapper.selectByUserAndMovie|语法|```public MovieLike selectByUserAndMovie(MovieLike record)```|
||前置条件|无|
||后置条件|获取符合条件的一个MovieLikePO对象|
|MovieLikeMapper.selectByMovieID|语法|```public List<MovieLike> selectByMovieID(int movieID)```|
||前置条件|无|
||后置条件|获取该电影的所有MovieLikePO对象|
|MovieLikeMapper.selectByMovieGroupByDate|语法|```public  List<Map<String, Object>> selectByMovieGroupByDate(int movieID)```|
||前置条件|无|
||后置条件|获取该电影的所有MovieLikePO对象和相应的日期|
|MovieLikeMapper.selectByUserID(int userID)|语法|```public List<MovieLike> selectByUserID(int userID)```|
||前置条件|无|
||后置条件|获取该用户的所有MovieLikePO对象|

##### 表 VipcardDataService接口规范

VipcardDataService的接口规范如下表所示

| 提供的服务（供接口）|||
| --------------- | -------- | -------- |
| VipcardMapper.insertSelective | 语法| ```public int insertSelective(Vipcard record)``` |
|| 前置条件 |无|
|| 后置条件 |插入一个VIPCardPO|
| VipcardMapper.deleteByPrimaryKey | 语法| ```public int deleteByPrimaryKey(Integer userId)``` |
|| 前置条件 |无|
|| 后置条件 | 删除一个VIPCardPO|
| VipcardMapper.updateByPrimaryKeySelective | 语法| ```public int updateByPrimaryKeySelective(Vipcard record)``` |
|| 前置条件 |无|
|| 后置条件 | 更新一个VIPCardPO|
| VipcardMapper.selectByPrimaryKey | 语法| ```public Vipcard selectByPrimaryKey(Integer userId)``` |
|| 前置条件 |无|
|| 后置条件 | 获得一个VIPCardPO|
| VipcardMapper.selectAll | 语法| ```public List<Vipcard> selectAll()``` |
|| 前置条件 |无|
|| 后置条件 | 获取所有VIPCardPO|
| TradeRecordMapper.insertSelective | 语法| ```public int insertSelective(TradeRecord record)``` |
|| 前置条件 |无|
|| 后置条件 |插入一个TradeRecordPO|
| TradeRecordMapper.deleteByPrimaryKey | 语法| ```public int deleteByPrimaryKey(Integer id)``` |
|| 前置条件 |无|
|| 后置条件 |删除一个TradeRecordPO|
| TradeRecordMapper.selectByPrimaryKey | 语法| ```public TradeRecord selectByPrimaryKey(Integer id)``` |
|| 前置条件 |无|
|| 后置条件 |获得一个TradeRecordPO|
| TradeRecordMapper.selectByUserID |语法| ```public List<TradeRecord> selectByUserID(Integer userID)``` |
|| 前置条件 |无|
|| 后置条件 |获得该用户所有的TradeRecordPO|
| VipcardRechargeReductionMapper.insertSelective | 语法| ```public int insertSelective(VipcardRechargeReduction record)``` |
|| 前置条件 |无|
|| 后置条件 |插入一个VipcardRechargeReductionPO|
| VipcardRechargeReductionMapper.deleteByPrimaryKey | 语法| ```public int deleteByPrimaryKey(Integer targetAmount)``` |
|| 前置条件 |无|
|| 后置条件 |删除一个VipcardRechargeReductionPO|
| VipcardRechargeReductionMapper.updateByPrimaryKeySelective | 语法| ```public  int updateByPrimaryKeySelective(VipcardRechargeReduction record)``` |
|| 前置条件 |无|
|| 后置条件 |更新一个VipcardRechargeReductionPO|
| VipcardRechargeReductionMapper.selectByPrimaryKey | 语法| ```public List<VipcardRechargeReduction> selectByPrimaryKey(Integer targetAmount)``` |
|| 前置条件 |无|
|| 后置条件 |获得一个或全部VipcardRechargeReductionPO|
| VipcardRechargeReductionMapper.selectByAmount | 语法| ```public VipcardRechargeReduction selectByAmount( Float amount)``` |
|| 前置条件 |无|
|| 后置条件 |获得最适合该Amount的一个VipcardRechargeReductionPO|

##### 表 SaleDataService接口规范

SaleDataService的接口规范如下表所示

| 提供的服务（供接口）|||
| - | - | - |
|PromotionMapper.insertSelective| 语法| ```public int insertSelective(Promotion record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个PromotionPO|
|PromotionMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个PromotionPO|
|PromotionMapper.updateByPrimaryKeySelective(| 语法| ```public int updateByPrimaryKeySelective(Promotion record)```|
|| 前置条件 | 无|
|| 后置条件 | 更新一个PromotionPO|
|PromotionMapper.selectByPrimaryKey| 语法| ```public Promotion selectByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 获得一个PromotionPO|
|PromotionMapper.selectAll| 语法| ```public List<Promotion> selectAll()```|
|| 前置条件 | 无|
|| 后置条件 | 获得所有的PromotionPO|
| PromotionMapper.init| 语法| ```public void init() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 初始化持久化数据库|
| PromotionMapper.finish| 语法| ```public void finish() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 结束持久化数据库的使用|
|PromotionHasMovieMapper.insertSelective| 语法| ```public int insertSelective(PromotionHasMovie record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个PromotionHasMoviePO|
|PromotionHasMovieMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(PromotionHasMovie key)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个PromotionHasMoviePO|
|PromotionHasMovieMapper.selectByPromotionID| 语法| ```public List<PromotionHasMovie> selectByPromotionID(int promotionID)```|
|| 前置条件 | 无|
|| 后置条件 | 返回包含该PromotionID的所有PromotionHasMoviePO|
|PromotionHasMovieMapper.selectByMovieID| 语法| ```public List<PromotionHasMovie> selectByMovieID(Integer movieID)```|
|| 前置条件 | 无|
|| 后置条件 |返回包含该MovieID的所有PromotionHasMoviePO|
|CouponMapper.insertSelective| 语法| ```public int insertSelective(Coupon record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个CouponPO|
|CouponMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个CouponPO|
|CouponMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(Coupon record)```|
|| 前置条件 | 无|
|| 后置条件 | 更新一个CouponPO|
|CouponMapper.selectByPrimaryKey| 语法| ```public Coupon selectByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 获得一个CouponPO|
|CouponMapper.selectByUserID| 语法| ```public List<Coupon> selectByUserID(int userID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该用户的所有CouponPO|
|RefundStrategyMapper.insertSelective| 语法| ```public int insertSelective(RefundStrategy record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个RefundStrategyPO|
|RefundStrategyMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个RefundStrategyPO|
|RefundStrategyMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(RefundStrategy record)```|
|| 前置条件 | 无|
|| 后置条件 | 更新一个RefundStrategyPO|
|RefundStrategyMapper.selectByPrimaryKey| 语法| ```public RefundStrategy selectByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 获得一个RefundStrategyPO|
|RefundStrategyMapper.selectAll| 语法| ```public  List<RefundStrategy> selectAll()```|
|| 前置条件 | 无|
|| 后置条件 | 获得所有的RefundStrategyPO|
|RefundStrategyMapper.selectByDay| 语法| ```public RefundStrategy selectByDay(long dayToCome)```|
|| 前置条件 | 无|
|| 后置条件 | 通过天数获得最适合的RefundStrategyPO|
|TicketsMapper.insertSelective| 语法| ```public int insertSelective(Ticket record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个TicketPO|
|TicketsMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个TicketPO|
|TicketsMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(Ticket record)```|
|| 前置条件 | 无|
|| 后置条件 | 更新一个TicketPO|
|TicketsMapper.selectByPrimaryKey| 语法| ```public Ticket selectByPrimaryKey(Integer id)```|
|| 前置条件 | 无|
|| 后置条件 | 获得一个TicketPO|
|TicketsMapper.selectByUserID| 语法| ```public List<Ticket> selectByUserID(int userID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该用户的所有TicketPO|
|TicketsMapper.selectByOrderID| 语法| ```public List<Ticket> selectByOrderID(long orderID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该订单的所有TicketPO|
|TicketsMapper.selectByMovieID| 语法| ```public List<Ticket> selectByMovieID(int movieID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该电影的所有TicketPO|
|TicketsMapper.selectByArrangementID| 语法| ```public List<Ticket> selectByArrangementID(int arrangementID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该场排片的所有TicketPO|
|TicketsMapper.selectByDate| 语法| ```public List<Ticket> selectByDate(Date startDate, Date endDate)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该时间段内的所有TicketPO|
|OrderMapper.insertSelective| 语法| ```public int insertSelective(Order record)```|
|| 前置条件 | 无|
|| 后置条件 | 插入一个OrderPO|
|OrderMapper.deleteByPrimaryKey| 语法| ```public int deleteByPrimaryKey(Long id)```|
|| 前置条件 | 无|
|| 后置条件 | 删除一个OrderPO|
|OrderMapper.updateByPrimaryKeySelective| 语法| ```public int updateByPrimaryKeySelective(Order record)```|
|| 前置条件 | 无|
|| 后置条件 | 更新一个OrderPO|
|OrderMapper.selectByPrimaryKey| 语法| ```public Order selectByPrimaryKey(Long id)```|
|| 前置条件 | 无|
|| 后置条件 | 获得一个OrderPO|
|OrderMapper.selectByUserAndOrderID| 语法| ```List<Order> selectByUserAndOrderID(int userID, long orderID)```|
|| 前置条件 | 无|
|| 后置条件 | 获得该用户的这个OrderPO|

##### 表 CinemaDataService接口规范

CinemaDataService的接口规范如下表所示

| 提供的服务（供接口）|||
| - | - | - |
|HallMapper.insertSelective|语法|```public int insertSelective(Hall record)```|
||前置条件|无|
||后置条件|插入一个HallPO|
|HallMapper.deleteByPrimaryKey|语法|```public int deleteByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|删除一个HallPO|
|HallMapper.updateByPrimaryKeySelective|语法|```public int updateByPrimaryKeySelective(Hall record)```|
||前置条件|无|
||后置条件|更新一个HallPO|
|HallMapper.selectByPrimaryKey|语法|```public Hall selectByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|获得一个HallPO|
|HallMapper.selectAll|语法|```public List<Hall> selectAll()```|
||前置条件|无|
||后置条件|获得所有的HallPO|
| HallMapper.init   | 语法| ```public void init() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 初始化持久化数据库|
| HallMapper.finish | 语法| ```public void finish() throws Exception```|
|| 前置条件 | 无|
|| 后置条件 | 结束持久化数据库的使用|
|SeatMapper.insertSelective|语法|```public int insertSelective(Seat record)```|
||前置条件|无|
||后置条件|插入一个SeatPO|
|SeatMapper.deleteByPrimaryKey|语法|```public int deleteByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|删除一个SeatPO|
|SeatMapper.updateByPrimaryKeySelective|语法|```public int updateByPrimaryKeySelective(Seat record)```|
||前置条件|无|
||后置条件|更新一个SeatPO|
|SeatMapper.selectByPrimaryKey|语法|```public Seat selectByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|获得一个SeatPO|
|SeatMapper.selectAll|语法|```public List<Seat> selectAll()```|
||前置条件|无|
||后置条件|获得所有的SeatPO|
|SeatMapper.selectByHallID|语法|```public List<Seat> selectByHallID(int hallID)```|
||前置条件|无|
||后置条件|获得该影厅所有的SeatPO|
|SeatMapper.deleteByHallID|语法|```public int deleteByHallID(int hallID)```|
||前置条件|无|
||后置条件|删除该影厅所有的SeatPO|
|ArrangementMapper.insertSelective|语法|```public int insertSelective(Arrangement record)```|
||前置条件|无|
||后置条件|插入一个ArrangementPO|
|ArrangementMapper.deleteByPrimaryKey|语法|```public int deleteByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|删除一个ArrangementPO|
|ArrangementMapper.updateByPrimaryKeySelective|语法|```public int updateByPrimaryKeySelective(Arrangement record)```|
||前置条件|无|
||后置条件|更新一个ArrangementPO|
|ArrangementMapper.selectByPrimaryKey|语法|```public Arrangement selectByPrimaryKey(Integer id)```|
||前置条件|无|
||后置条件|获得一个ArrangementPO|
|ArrangementMapper.selectByMovieID|语法|```public List<Arrangement> selectByMovieID(int movieID)```|
||前置条件|无|
||后置条件|获得该电影所有的ArrangementPO|
|ArrangementMapper.selectByHallIDAndStartDate|语法|```public List<Arrangement> selectByHallIDAndStartDate(int hallID,Date startDate,int duration)```|
||前置条件|无|
||后置条件|获得该影厅StartDate后duration天内所有的ArrangementPO|
|ArrangementMapper.selectByHallIDAndCurrentTime|语法|```public List<Arrangement> selectByHallIDAndCurrentTime(int hallID,Date currentTime)```|
||前置条件|无|
||后置条件|获得该影厅currentTime后所有的ArrangementPO|
|ArrangementMapper.selectByDay|语法|```public List<Arrangement> selectByDay(Date startDay,Date endDay)```|
||前置条件|无|
||后置条件|获得该时间段内所有的ArrangementPO|
|ArrangementSeatMapper.insertSelective|语法|```public int insertSelective(ArrangementSeat record)```|
||前置条件|无|
||后置条件|插入一个ArrangementSeatPO|
|ArrangementSeatMapper.delete|语法|```public int delete(ArrangementSeat record)```|
||前置条件|无|
||后置条件|删除一个ArrangementSeatPO|
|ArrangementSeatMapper.updateSeatStatus|语法|```public int updateSeatStatus(ArrangementSeat record)```|
||前置条件|无|
||后置条件|更新一个ArrangementSeatPO里Seat的状态|
|ArrangementSeatMapper.select|语法|```public ArrangementSeat select(ArrangementSeat record)```|
||前置条件|无|
||后置条件|获得一个ArrangementSeatPO|
|ArrangementSeatSeatMapper.selectByArrangementID|语法|```public List<ArrangementSeat> selectByArrangementID(int arrangementId)```|
||前置条件|无|
||后置条件|获得该场排片的所有ArrangementSeatPO|

## 6. 信息视角

### 6.1 数据持久化对象

- User类包含用户ID、用户名、密码
- Role类包含角色ID、角色名称
- UserHasRoleKey类包含用户ID、角色ID
- Movie类包含名称、电影海报链接、导演、编剧、主演、类型、制片国家/地区、语言、上架日期、上映日期、片长和下映日期
- MovieLike类包含用户ID、电影ID、想看时间
- Vipcard类包含用户ID和会员卡余额
- VipcardRechargeReduction类包含目标金额、优惠金额
- TradeRecord类包含会员充值记录ID、充值金额、会员卡余额、充值日期、用户ID
- Hall类包含影厅ID、名称、排数、列数、大小、是否IMax影厅、是否3D影厅
- Seat类包含座位ID、排、列、影厅ID
- Arrangement类包含排片ID、排片时间起/终点、票价、影厅ID、电影ID和可见时间
- ArrangementSeat类包含排片ID、座位ID、是否锁座
- Promotion类包含优惠活动ID、名称、活动时间起/终点、是不是指定电影、优惠劵的有效期、目标金额、优惠金额和活动简介
- PromotionHasMovie类包含活动ID、电影ID
- Coupon类包含优惠券ID、结束时间、优惠活动ID、用户ID
- RefundStrategy类包含天数、能否退票、百分比
- Ticket类包含电影票ID、用户ID、排片ID、座位ID、完成时间、状态、实付金额、订单ID
- Order类包含订单ID、实付金额、原始金额、完成时间、支付方式、用户ID

持久化用户对象UserPO的定义如下所示

```java
public class User {
    private Integer id;

    private String name;

    private String password;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name == null ? null : name.trim();
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password == null ? null : password.trim();
    }
}
```

持久化角色对象RolePO的定义如下所示

```java
public class Role {
    private Integer id;

    private String roleName;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getRoleName() {
        return roleName;
    }

    public void setRoleName(String roleName) {
        this.roleName = roleName == null ? null : roleName.trim();
    }
}
```

持久化用户角色对象UserHasRoleKeyPO的定义如下所示

```java
public class UserHasRoleKey {
    private Integer userId;

    private Integer roleId;

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Integer getRoleId() {
        return roleId;
    }

    public void setRoleId(Integer roleId) {
        this.roleId = roleId;
    }
}
```

持久化电影对象MoviePO的定义如下所示

```java
public class Movie {
    private Integer id;

    private String name;

    private String poster;

    private String director;

    private String screenWriter;

    private String starring;

    private String type;

    private String country;

    private String language;

    private Integer duration;

    private Date releaseDate;

    private Date startDate;

    private Byte status;

    private String description;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name == null ? null : name.trim();
    }

    public String getPoster() {
        return poster;
    }

    public void setPoster(String poster) {
        this.poster = poster == null ? null : poster.trim();
    }

    public String getDirector() {
        return director;
    }

    public void setDirector(String director) {
        this.director = director == null ? null : director.trim();
    }

    public String getScreenWriter() {
        return screenWriter;
    }

    public void setScreenWriter(String screenWriter) {
        this.screenWriter = screenWriter == null ? null : screenWriter.trim();
    }

    public String getStarring() {
        return starring;
    }

    public void setStarring(String starring) {
        this.starring = starring == null ? null : starring.trim();
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type == null ? null : type.trim();
    }

    public String getCountry() {
        return country;
    }

    public void setCountry(String country) {
        this.country = country == null ? null : country.trim();
    }

    public String getLanguage() {
        return language;
    }

    public void setLanguage(String language) {
        this.language = language == null ? null : language.trim();
    }

    public Integer getDuration() {
        return duration;
    }

    public void setDuration(Integer duration) {
        this.duration = duration;
    }

    public Date getReleaseDate() {
        return releaseDate;
    }

    public void setReleaseDate(Date releaseDate) {
        this.releaseDate = releaseDate;
    }

    public Date getStartDate() {
        return startDate;
    }

    public void setStartDate(Date startDate) {
        this.startDate = startDate;
    }

    public Byte getStatus() {
        return status;
    }

    public boolean audienceVisible() {
        return status <= 3;
    }

    public void setStatus(Byte status) {
        this.status = status;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description == null ? null : description.trim();
    }
}
```

持久化电影想看MovieLikePO的定义如下所示

```java
public class MovieLike {
    private Integer userId;

    private Integer movieId;

    private Date date;

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Integer getMovieId() {
        return movieId;
    }

    public void setMovieId(Integer movieId) {
        this.movieId = movieId;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }
}
```

持久化会员卡对象VipcardPO的定义如下所示

```java
public class Vipcard {
    private Integer userId;

    private Float balance;

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Float getBalance() {
        return balance;
    }

    public void setBalance(Float balance) {
        this.balance = balance;
    }
}
```

持久化会员卡充值策略对象VipcardRechargeReductionPO的定义如下所示

```java
public class VipcardRechargeReduction {

    private Integer targetAmount;

    private Float discountAmount;

    public Integer getTargetAmount() {
        return targetAmount;
    }

    public void setTargetAmount(Integer targetAmount) {
        this.targetAmount = targetAmount;
    }

    public Float getDiscountAmount() {
        return discountAmount;
    }

    public void setDiscountAmount(Float discountAmount) {
        this.discountAmount = discountAmount;
    }
}
```

持久化会员充值记录对象TradeRecordPO的定义如下所示

```java
public class TradeRecord {
    private Integer id;

    private Float originalAmount;

    private Float delta;

    private Date date;

    private Integer userId;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Float getOriginalAmount() {
        return originalAmount;
    }

    public void setOriginalAmount(Float originalAmount) {
        this.originalAmount = originalAmount;
    }

    public Float getDelta() {
        return delta;
    }

    public void setDelta(Float delta) {
        this.delta = delta;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }
}
```

持久化影厅对象HallPO的定义如下所示

```java
    public class Hall {
    private Integer id;

    private String name;

    private Integer column;

    private Integer row;

    private Byte size;

    private Byte isImax;

    private Byte is3d;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name == null ? null : name.trim();
    }

    public Integer getColumn() {
        return column;
    }

    public void setColumn(Integer column) {
        this.column = column;
    }

    public Integer getRow() {
        return row;
    }

    public void setRow(Integer row) {
        this.row = row;
    }

    public Byte getSize() {
        return size;
    }

    public void setSize(Byte size) {
        this.size = size;
    }

    public Byte getIsImax() {
        return isImax;
    }

    public void setIsImax(Byte isImax) {
        this.isImax = isImax;
    }

    public Byte getIs3d() {
        return is3d;
    }

    public void setIs3d(Byte is3d) {
        this.is3d = is3d;
    }
}
```

持久化座位对象SeatPO的定义如下所示

```java
public class Seat {
    private Integer id;

    private Integer column;

    private Integer row;

    private Integer hallId;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getColumn() {
        return column;
    }

    public void setColumn(Integer column) {
        this.column = column;
    }

    public Integer getRow() {
        return row;
    }

    public void setRow(Integer row) {
        this.row = row;
    }

    public Integer getHallId() {
        return hallId;
    }

    public void setHallId(Integer hallId) {
        this.hallId = hallId;
    }
}
```

持久化排片对象ArrangementPO的定义如下所示

```java
public class Arrangement {
    private Integer id;

    private Date startTime;

    private Date endTime;

    private Float fare;

    private Integer hallId;

    private Integer movieId;

    private Date visibleDate;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Date getStartTime() {
        return startTime;
    }

    public void setStartTime(Date startTime) {
        this.startTime = startTime;
    }

    public Date getEndTime() {
        return endTime;
    }

    public void setEndTime(Date endTime) {
        this.endTime = endTime;
    }

    public Float getFare() {
        return fare;
    }

    public void setFare(Float fare) {
        this.fare = fare;
    }

    public Integer getHallId() {
        return hallId;
    }

    public void setHallId(Integer hallId) {
        this.hallId = hallId;
    }

    public Integer getMovieId() {
        return movieId;
    }

    public void setMovieId(Integer movieId) {
        this.movieId = movieId;
    }

    public Date getVisibleDate() {
        return visibleDate;
    }

    public void setVisibleDate(Date visibleDate) {
        this.visibleDate = visibleDate;
    }
}
```

持久化排片座位对象ArrangementSeatPO的定义如下所示

```java
public class ArrangementSeat {
    private Byte isLocked;

    private Integer arrangementId;

    private Integer seatId;

    public Byte getIsLocked() {
        return isLocked;
    }

    public void setIsLocked(Byte isLocked) {
        this.isLocked = isLocked;
    }

    public Integer getArrangementId() {
        return arrangementId;
    }

    public void setArrangementId(Integer arrangementId) {
        this.arrangementId = arrangementId;
    }

    public Integer getSeatId() {
        return seatId;
    }

    public void setSeatId(Integer seatId) {
        this.seatId = seatId;
    }
}
```


持久化优惠活动对象PromotionPO的定义如下所示

```java
public class Promotion {
    private Integer id;

    private String name;

    private Date startTime;

    private Date endTime;

    private Byte specifyMovies;

    private Float targetAmount;

    private Float couponAmount;

    private Integer couponExpiration;

    private String description;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name == null ? null : name.trim();
    }

    public Date getStartTime() {
        return startTime;
    }

    public void setStartTime(Date startTime) {
        this.startTime = startTime;
    }

    public Date getEndTime() {
        return endTime;
    }

    public void setEndTime(Date endTime) {
        this.endTime = endTime;
    }

    public Byte getSpecifyMovies() {
        return specifyMovies;
    }

    public void setSpecifyMovies(Byte specifyMovies) {
        this.specifyMovies = specifyMovies;
    }

    public Float getTargetAmount() {
        return targetAmount;
    }

    public void setTargetAmount(Float targetAmount) {
        this.targetAmount = targetAmount;
    }

    public Float getCouponAmount() {
        return couponAmount;
    }

    public void setCouponAmount(Float couponAmount) {
        this.couponAmount = couponAmount;
    }

    public Integer getCouponExpiration() {
        return couponExpiration;
    }

    public void setCouponExpiration(Integer couponExpiration) {
        this.couponExpiration = couponExpiration;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description == null ? null : description.trim();
    }
}
```

持久化活动电影对象PromotionHasMoviePO的定义如下

```java
public class PromotionHasMovie {
    private Integer promotionId;

    private Integer movieId;

    public Integer getPromotionId() {
        return promotionId;
    }

    public void setPromotionId(Integer promotionId) {
        this.promotionId = promotionId;
    }

    public Integer getMovieId() {
        return movieId;
    }

    public void setMovieId(Integer movieId) {
        this.movieId = movieId;
    }
}
```

持久化优惠劵对象CouponPO的定义如下

```java
public class Coupon {
    private Integer id;

    private Date endTime;

    private Integer promotionId;

    private Integer userId;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Date getEndTime() {
        return endTime;
    }

    public void setEndTime(Date endTime) {
        this.endTime = endTime;
    }

    public Integer getPromotionId() {
        return promotionId;
    }

    public void setPromotionId(Integer promotionId) {
        this.promotionId = promotionId;
    }

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }
}
```

持久化退票策略对象RefundStrategyPO的定义如下所示

```java
public class RefundStrategy {
    private Integer day;

    private Byte refundable;

    private Float percentage;

    public Integer getDay() {
        return day;
    }

    public void setDay(Integer day) {
        this.day = day;
    }

    public Byte getRefundable() {
        return refundable;
    }

    public boolean canRefund() {
        return refundable == 1;
    }

    public void setRefundable(Byte refundable) {
        this.refundable = refundable;
    }

    public Float getPercentage() {
        return percentage;
    }

    public void setPercentage(Float percentage) {
        this.percentage = percentage;
    }
}
```

持久化电影票对象TicketPO的定义如下所示

```java
public class Ticket {
    private Integer id;

    private Integer userId;

    private Integer arrangementId;

    private Integer seatId;

    private Date date;

    private Byte status;

    private Float realAmount;

    private Long orderID;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Integer getArrangementId() {
        return arrangementId;
    }

    public void setArrangementId(Integer arrangementId) {
        this.arrangementId = arrangementId;
    }

    public Integer getSeatId() {
        return seatId;
    }

    public void setSeatId(Integer seatId) {
        this.seatId = seatId;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public Byte getStatus() {
        return status;
    }

    public void setStatus(Byte status) {
        this.status = status;
    }

    public Float getRealAmount() {
        return realAmount;
    }

    public void setRealAmount(Float realAmount) {
        this.realAmount = realAmount;
    }

    public Long getOrderID() {
        return orderID;
    }

    public void setOrderID(Long orderID) {
        this.orderID = orderID;
    }
}
```

持久化电影票订单对象OrderPO的定义如下所示

```java
public class Order {
    private Long id;

    private Float realAmount;

    private Float originalAmount;

    private Date date;

    private Byte useVipcard;

    private Integer userId;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Float getRealAmount() {
        return realAmount;
    }

    public void setRealAmount(Float realAmount) {
        this.realAmount = realAmount;
    }

    public Float getOriginalAmount() {
        return originalAmount;
    }

    public void setOriginalAmount(Float originalAmount) {
        this.originalAmount = originalAmount;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public Byte getStatus() {
        return useVipcard;
    }

    public void setUseVipcard(Byte useVipcard) {
        this.useVipcard = useVipcard;
    }

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }
}
```

### 6.2 数据库表

数据库表中包含User表、Role表、UserHasRoleKey表、Movie表、MovieLike表、Vipcard表、VipcardRechargeReduction表、TradeRecord表、Hall表、Seat表、Arrangement表、ArrangementSeat表、Promotion表、PromotionHasMovie表、Coupon表、RefundStrategy表、Ticket表、Order表。
